<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectral Synthesizer - Hear Molecules</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header role="banner">
        <h1>üéµ Spectral Synthesizer</h1>
        <p class="tagline">Making molecular fingerprints audible through sonification</p>
    </header>

    <main role="main">
        <section class="info-panel" aria-label="Introduction">
            <h2>The Connection</h2>
            <p>
                FTIR spectroscopy and audio both use <strong>Fourier transforms</strong> to decompose signals
                into frequency components. This tool maps infrared absorption spectra (molecular vibrations)
                down to audible frequencies, revealing what molecules "sound like".
            </p>
            <p style="margin-top: 1rem; padding: 0.75rem; background: rgba(139, 92, 246, 0.15); border-left: 3px solid #8b5cf6; border-radius: 4px;">
                <strong>Now using real data!</strong> This version includes 381 authentic FTIR spectra from the
                <a href="https://enfsi.eu/" target="_blank" style="color: #a78bfa;">ENFSI DWG IR Library</a>
                (European Network of Forensic Science Institutes), providing scientifically accurate molecular fingerprints.
            </p>
        </section>

        <section class="mode-selector" role="group" aria-label="View mode selection">
            <button id="single-mode" class="mode-button active" aria-pressed="true">Single View</button>
            <button id="comparison-mode" class="mode-button" aria-pressed="false">Comparison Mode</button>
        </section>

        <section class="controls" id="single-controls" aria-label="Playback controls">
            <div class="filter-controls" role="group" aria-label="Substance filters">
                <div class="search-box">
                    <label for="search">Search substances:</label>
                    <input type="text" id="search" placeholder="Type to search..." />
                </div>

                <div class="category-filter">
                    <label for="category">Filter by category:</label>
                    <select id="category">
                        <option value="all">All Categories</option>
                        <option value="opioids">Opioids</option>
                        <option value="stimulants">Stimulants</option>
                        <option value="benzodiazepines">Benzodiazepines</option>
                        <option value="psychedelics">Psychedelics</option>
                        <option value="cannabinoids">Cannabinoids</option>
                        <option value="steroids">Steroids</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="results-count">
                    <span id="results-count">381 substances</span>
                </div>
            </div>

            <div class="substance-selector">
                <label for="substance">Select a substance:</label>
                <select id="substance">
                    <option value="">-- Loading library... --</option>
                </select>
            </div>

            <div class="playback-controls" role="group" aria-label="Playback buttons">
                <button id="play" disabled aria-label="Play sound from selected substance">‚ñ∂ Play Sound</button>
                <button id="stop" disabled aria-label="Stop playback">‚ñ† Stop</button>
                <div class="slider-control">
                    <label for="duration">Duration: <span id="duration-value">2.0</span>s</label>
                    <input type="range" id="duration" min="0.5" max="5" step="0.1" value="2">
                </div>
                <div class="slider-control">
                    <label for="volume">Volume: <span id="volume-value">50</span>%</label>
                    <input type="range" id="volume" min="0" max="100" step="1" value="50">
                </div>
            </div>

            <div class="audio-effects">
                <h4 class="effects-title">Audio Effects</h4>
                <div class="effects-grid">
                    <div class="slider-control">
                        <label for="reverb">Reverb: <span id="reverb-value">0</span>%</label>
                        <input type="range" id="reverb" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-control">
                        <label for="filter-freq">Filter: <span id="filter-freq-value">8000</span> Hz</label>
                        <input type="range" id="filter-freq" min="100" max="8000" step="100" value="8000">
                    </div>
                </div>
                <div class="preset-controls">
                    <label for="preset-select">Presets:</label>
                    <select id="preset-select" aria-label="Select audio effect preset">
                        <option value="">-- Select Preset --</option>
                    </select>
                </div>
            </div>

            <div class="import-export-controls" role="group" aria-label="Import and export controls">
                <h4 class="section-title">Import & Export</h4>
                <div class="import-export-grid">
                    <div class="import-section">
                        <label for="csv-import" class="file-label">
                            üìÅ Import CSV
                        </label>
                        <input type="file" id="csv-import" accept=".csv" style="display: none;" aria-label="Import FTIR data from CSV file">
                        <button id="download-template" class="secondary-button" aria-label="Download CSV template">
                            üìã Download Template
                        </button>
                    </div>
                    <div class="export-section">
                        <button id="export-wav" disabled class="secondary-button" aria-label="Export audio as WAV file">
                            üíæ Export WAV
                        </button>
                    </div>
                </div>
            </div>

            <div class="peak-selection-controls" role="group" aria-label="Peak selection controls">
                <div class="selection-info" role="status" aria-live="polite">
                    <span id="selection-count">Click peaks on the FTIR spectrum to select them</span>
                </div>
                <div class="selection-buttons">
                    <button id="play-selected" disabled aria-label="Play only selected peaks">‚ñ∂ Play Selected</button>
                    <button id="select-all" disabled aria-label="Select all peaks">Select All</button>
                    <button id="clear-selection" disabled aria-label="Clear peak selection">Clear Selection</button>
                </div>
            </div>
        </section>

        <section class="controls comparison-controls" id="comparison-controls" style="display: none;">
            <div class="comparison-grid">
                <div class="comparison-side">
                    <h3 class="comparison-title">Substance A</h3>
                    <div class="substance-selector">
                        <label for="substance-a">Select substance:</label>
                        <select id="substance-a">
                            <option value="">-- Select --</option>
                        </select>
                    </div>
                    <div class="comparison-playback">
                        <button id="play-a" disabled>‚ñ∂ Play A</button>
                    </div>
                </div>

                <div class="comparison-side">
                    <h3 class="comparison-title">Substance B</h3>
                    <div class="substance-selector">
                        <label for="substance-b">Select substance:</label>
                        <select id="substance-b">
                            <option value="">-- Select --</option>
                        </select>
                    </div>
                    <div class="comparison-playback">
                        <button id="play-b" disabled>‚ñ∂ Play B</button>
                    </div>
                </div>
            </div>

            <div class="comparison-combined">
                <button id="play-both-sequential" disabled>‚ñ∂ Play A ‚Üí B (Sequential)</button>
                <button id="play-both-simultaneous" disabled>‚ñ∂ Play A + B (Simultaneous)</button>
            </div>

            <div class="slider-control">
                <label for="comparison-duration">Duration: <span id="comparison-duration-value">2.0</span>s</label>
                <input type="range" id="comparison-duration" min="0.5" max="5" step="0.1" value="2">
            </div>
        </section>

        <section class="visualization single-visualization" aria-label="Visualization">
            <div class="viz-panel">
                <h3>FTIR Spectrum (Infrared)</h3>
                <canvas id="ftir-canvas" width="600" height="300" role="img" aria-label="FTIR spectrum visualization"></canvas>
                <div class="axis-labels">
                    <span class="axis-label-x">Wavenumber (cm‚Åª¬π)</span>
                    <span class="axis-label-y">Transmittance (%)</span>
                </div>
            </div>

            <div class="viz-panel">
                <h3>Audio FFT (Audible)</h3>
                <canvas id="audio-canvas" width="600" height="300" role="img" aria-label="Audio FFT visualization"></canvas>
                <div class="axis-labels">
                    <span class="axis-label-x">Frequency (Hz)</span>
                    <span class="axis-label-y">Amplitude</span>
                </div>
            </div>
        </section>

        <section class="visualization comparison-visualization" id="comparison-visualization" style="display: none;">
            <div class="comparison-viz-grid">
                <div class="viz-panel">
                    <h3>Substance A - FTIR Spectrum</h3>
                    <canvas id="ftir-canvas-a" width="600" height="300"></canvas>
                    <div class="axis-labels">
                        <span class="axis-label-x">Wavenumber (cm‚Åª¬π)</span>
                        <span class="axis-label-y">Transmittance (%)</span>
                    </div>
                </div>

                <div class="viz-panel">
                    <h3>Substance B - FTIR Spectrum</h3>
                    <canvas id="ftir-canvas-b" width="600" height="300"></canvas>
                    <div class="axis-labels">
                        <span class="axis-label-x">Wavenumber (cm‚Åª¬π)</span>
                        <span class="axis-label-y">Transmittance (%)</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="info-panel">
            <h2>Keyboard Shortcuts</h2>
            <div class="keyboard-shortcuts">
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>Space</kbd>
                        <span>Play / Stop</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>‚Üë</kbd> / <kbd>‚Üì</kbd>
                        <span>Navigate substances</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>A</kbd>
                        <span>Select all peaks</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>C</kbd>
                        <span>Clear peak selection</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd>
                        <span>Clear search/filters</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="info-panel">
            <h2>Understanding the Mapping</h2>
            <div id="mapping-info" class="mapping-info">
                <p>Select a substance to see how infrared frequencies map to audio frequencies.</p>
            </div>
        </section>

        <section class="info-panel">
            <h2>The Science</h2>
            <div class="science-explanation">
                <h3>Why molecules absorb infrared light</h3>
                <p>
                    Chemical bonds vibrate at specific frequencies. When infrared light matches these
                    vibrational frequencies, the molecule absorbs that light. Different molecular structures
                    create different absorption patterns - a unique "fingerprint".
                </p>

                <h3>The Fourier Transform connection</h3>
                <p>
                    Both FTIR and audio analysis use the same mathematical tool: the Fourier Transform.
                    It decomposes complex signals into individual frequency components. In FTIR, we're
                    analyzing molecular vibrations (~10¬π¬≥ Hz). In audio, we're analyzing sound waves (~100-10000 Hz).
                </p>

                <h3>The sonification process</h3>
                <ol>
                    <li>Extract absorption peaks from FTIR spectrum</li>
                    <li>Map IR wavenumbers (400-4000 cm‚Åª¬π) to audio frequencies (20-20000 Hz) logarithmically</li>
                    <li>Create oscillators at mapped frequencies with amplitudes based on absorption intensity</li>
                    <li>Synthesize the sound and visualize its FFT in real-time</li>
                </ol>
            </div>
        </section>
    </main>

    <footer role="contentinfo">
        <p>
            <strong>Note:</strong> This is an educational/artistic tool, not for substance identification or drug checking.
            FTIR data sourced from scientific databases.
        </p>
    </footer>

    <!-- Configuration must be loaded first -->
    <script src="config.js"></script>
    
    <!-- Core modules -->
    <script src="frequency-mapper.js"></script>
    <script src="audio-engine.js"></script>
    <script src="visualizer.js"></script>
    <script src="csv-importer.js"></script>
    
    <!-- Main application -->
    <script src="app.js"></script>
</body>
</html>
